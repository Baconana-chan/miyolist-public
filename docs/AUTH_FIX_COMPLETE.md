# ๐ฏ ะัะพะณะพะฒะฐั ะธะฝััััะบัะธั - ะัะฟัะฐะฒะปะตะฝะธะต ะฐะฒัะพัะธะทะฐัะธะธ

## โ ะงัะพ ะฑัะปะพ ะธัะฟัะฐะฒะปะตะฝะพ:

### ะัะพะฑะปะตะผะฐ:
```
Authentication error: Invalid argument(s): 
Callback url scheme must start with http://localhost:{port}
```

### ะัะธัะธะฝะฐ:
- ะะธะฑะปะธะพัะตะบะฐ `flutter_web_auth_2` ะฝะฐ **Windows ััะตะฑัะตั `http://localhost:{port}`**
- Custom schemes (`miyolist://`) ัะฐะฑะพัะฐัั **ัะพะปัะบะพ ะฝะฐ ะผะพะฑะธะปัะฝัั ััััะพะนััะฒะฐั**
- ะ ะบะพะดะต ะธัะฟะพะปัะทะพะฒะฐะปัั ะฝะตะฟัะฐะฒะธะปัะฝัะน callback scheme ะดะปั Windows

### ะะตัะตะฝะธะต:
1. โ ะะฐะทะดะตะปะตะฝั URI ะดะปั desktop ะธ mobile ะฒ `app_constants.dart`
2. โ ะะพะฑะฐะฒะปะตะฝะพ ะฐะฒัะพะพะฟัะตะดะตะปะตะฝะธะต ะฟะปะฐััะพัะผั ะฒ `auth_service.dart`
3. โ ะะพะฑะฐะฒะปะตะฝั debug ะปะพะณะธ ะดะปั ะพัะปะฐะดะบะธ

---

## ๐ง ะงัะพ ะฝัะถะฝะพ ัะดะตะปะฐัั ะกะะะงะะก:

### ะจะฐะณ 1: ะะฑะฝะพะฒะธัั ะฝะฐัััะพะนะบะธ ะฝะฐ AniList

**ะะะฏะะะขะะะฌะะ!** ะะตะท ััะพะณะพ ะฐะฒัะพัะธะทะฐัะธั ะฝะต ะทะฐัะฐะฑะพัะฐะตั.

1. ะัะบัะพะนัะต: https://anilist.co/settings/developer
2. ะะฐะนะดะธัะต ะฟัะธะปะพะถะตะฝะธะต ั **Client ID: 31113**
3. ะ ัะฐะทะดะตะปะต **"Redirect URI"** ะดะพะฑะฐะฒััะต:
   ```
   http://localhost:8080/auth
   ```
   
4. ะัะปะธ ะฟะปะฐะฝะธััะตัะต ะฟะพะดะดะตัะถะบั Android/iOS, ะดะพะฑะฐะฒััะต ัะฐะบะถะต:
   ```
   miyolist://auth
   ```

5. ะะฐะถะผะธัะต **"Save"** ะธะปะธ **"Update"**

**ะกะบัะธะฝัะพั ัะพะณะพ, ะบะฐะบ ะดะพะปะถะฝะพ ะฒัะณะปัะดะตัั:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Redirect URI:                       โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ http://localhost:8080/auth      โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ miyolist://auth                 โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะจะฐะณ 2: ะะตัะตะทะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต

```powershell
# ะ PowerShell
flutter run -d windows
```

### ะจะฐะณ 3: ะขะตััะธัะพะฒะฐะฝะธะต

1. ะัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต
2. ะะฐะถะผะธัะต ะบะฝะพะฟะบั **"Login with AniList"**
3. **ะัะพะฒะตัััะต ะบะพะฝัะพะปั** - ะดะพะปะถะฝะพ ะฟะพัะฒะธัััั:

```
๐ Auth URL: https://anilist.co/api/v2/oauth/authorize?client_id=31113&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2Fauth&response_type=code
๐ Redirect URI: http://localhost:8080/auth
๐ Callback scheme: http
```

4. **ะัะบัะพะตััั ะฑัะฐัะทะตั** ั ะฐะฒัะพัะธะทะฐัะธะตะน AniList
5. ะะฐะถะผะธัะต **"Approve"**
6. **ะะพะฝัะพะปั ะดะพะปะถะฝะฐ ะฟะพะบะฐะทะฐัั**:

```
โ Auth result: http://localhost:8080/auth?code=def50200...
```

7. **ะัะธะปะพะถะตะฝะธะต ะดะพะปะถะฝะพ ะฒะตัะฝััััั** ะบ ะณะปะฐะฒะฝะพะผั ัะบัะฐะฝั, ะทะฐะปะพะณะธะฝะธะฒ ะฒะฐั

---

## ๐ ะงะฐัััะต ะฟัะพะฑะปะตะผั:

### โ "Invalid redirect_uri"

**ะะพะฝัะพะปั:**
```
Authentication error: invalid_request: The redirect_uri provided does not match the registered redirect_uri
```

**ะะตัะตะฝะธะต:**
1. ะัะพะฒะตัััะต AniList โ Settings โ Developer
2. ะฃะฑะตะดะธัะตัั, ััะพ ัะฐะผ **ัะพัะฝะพ** `http://localhost:8080/auth`
3. ะะตั ะปะธัะฝะธั ะฟัะพะฑะตะปะพะฒ, ะฟัะฐะฒะธะปัะฝัะน ะฟะพัั (8080)
4. ะกะพััะฐะฝะธัะต ะธะทะผะตะฝะตะฝะธั
5. ะะตัะตะทะฐะฟัััะธัะต ะฟัะธะปะพะถะตะฝะธะต

---

### โ "Callback url scheme must start with http://localhost"

**ะะพะฝัะพะปั:**
```
Authentication error: Invalid argument(s): Callback url scheme must start with http://localhost:{port}
```

**ะะตัะตะฝะธะต:**
1. ะะฐ AniList ะดะพะปะถะตะฝ ะฑััั ะดะพะฑะฐะฒะปะตะฝ `http://localhost:8080/auth`
2. ะัะปะธ ะตะณะพ ะฝะตั - ะดะพะฑะฐะฒััะต ะฟััะผะพ ัะตะนัะฐั
3. ะะพะด ัะถะต ะธัะฟัะฐะฒะปะตะฝ, ะฝัะถะฝะพ ัะพะปัะบะพ ะฝะฐัััะพะธัั AniList

---

### โ ะัะฐัะทะตั ะพัะบััะปัั, ะฝะพ ะฟัะธะปะพะถะตะฝะธะต ะฝะต ะฒะตัะฝัะปะพัั

**ะกะธะผะฟัะพะผ:**
- ะัะฐัะทะตั ะฟะพะบะฐะทัะฒะฐะตั "You have been redirected"
- ะัะธะปะพะถะตะฝะธะต ะฝะต ัะตะฐะณะธััะตั
- ะ ะบะพะฝัะพะปะธ ะฝะตั `โ Auth result`

**ะะตัะตะฝะธะต:**
1. ะัะพะฒะตัััะต, ััะพ ะฟะพัั 8080 ัะฒะพะฑะพะดะตะฝ:
   ```powershell
   netstat -ano | findstr :8080
   ```
2. ะัะปะธ ะฟะพัั ะทะฐะฝัั, ะทะฐะบัะพะนัะต ะฟัะพัะตัั ะธะปะธ ะธะทะผะตะฝะธัะต ะฟะพัั ะฒ `app_constants.dart`:
   ```dart
   static const String redirectUriDesktop = 'http://localhost:9999/auth';
   ```
   ะ ะพะฑะฝะพะฒะธัะต ะฝะฐ AniList!

---

### โ ะัะธะปะพะถะตะฝะธะต ะฒัะปะตัะฐะตั ะฟัะธ ะปะพะณะธะฝะต

**ะะพะฝัะพะปั:**
```
Exception: Authorization code not found
```

**ะะตัะตะฝะธะต:**
1. ะฃะฑะตะดะธัะตัั, ััะพ ะฝะฐ AniList ะฝะฐะถะฐะปะธ **"Approve"**
2. ะัะพะฒะตัััะต, ััะพ callback ะฒะตัะฝัะปัั ั ะฟะฐัะฐะผะตััะพะผ `?code=...`
3. ะัะพะฒะตัััะต ะบะพะฝัะพะปั ะฝะฐ ะฝะฐะปะธัะธะต `โ Auth result`

---

## ๐ ะขะตัะฝะธัะตัะบะฐั ะธะฝัะพัะผะฐัะธั:

### ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั:

**1. `lib/core/constants/app_constants.dart`**
```dart
// ะัะปะพ:
static const String redirectUri = 'miyolist://auth';

// ะกัะฐะปะพ:
static const String redirectUriMobile = 'miyolist://auth';
static const String redirectUriDesktop = 'http://localhost:8080/auth';
```

**2. `lib/core/services/auth_service.dart`**
```dart
// ะะพะฑะฐะฒะปะตะฝะพ:
String get redirectUri {
  if (Platform.isWindows || Platform.isLinux || Platform.isMacOS) {
    return AppConstants.redirectUriDesktop;
  } else {
    return AppConstants.redirectUriMobile;
  }
}

String get callbackUrlScheme {
  if (Platform.isWindows || Platform.isLinux || Platform.isMacOS) {
    return 'http';  // ะะ 'http://localhost:8080'!
  } else {
    return 'miyolist';
  }
}
```

### ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั:

1. **Windows/Linux/macOS:**
   - Redirect URI: `http://localhost:8080/auth`
   - Callback scheme: `http` (ัะพะปัะบะพ ะฟัะพัะพะบะพะป!)
   - ะะธะฑะปะธะพัะตะบะฐ ะทะฐะฟััะบะฐะตั ะปะพะบะฐะปัะฝัะน HTTP ัะตัะฒะตั ะฝะฐ ะฟะพััั 8080
   - ะัะฐัะทะตั ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตั ะฝะฐ ััะพั ัะตัะฒะตั ั ะบะพะดะพะผ ะฐะฒัะพัะธะทะฐัะธะธ

2. **Android/iOS:**
   - Redirect URI: `miyolist://auth`
   - Callback scheme: `miyolist` (ะฑะตะท `://`)
   - ะะก ัะตะณะธัััะธััะตั custom scheme ะดะปั ะฟัะธะปะพะถะตะฝะธั
   - ะัะฐัะทะตั ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตั ะฝะฐะฟััะผัั ะฒ ะฟัะธะปะพะถะตะฝะธะต

---

## โ ะะพะฝััะพะปัะฝัะน ัะฟะธัะพะบ:

ะัะผะตัััะต ะฒัั, ััะพ ัะดะตะปะฐะปะธ:

- [ ] ะัะบััะป https://anilist.co/settings/developer
- [ ] ะะฐััะป ะฟัะธะปะพะถะตะฝะธะต ั Client ID: 31113
- [ ] ะะพะฑะฐะฒะธะป `http://localhost:8080/auth` ะฒ Redirect URI
- [ ] ะกะพััะฐะฝะธะป ะธะทะผะตะฝะตะฝะธั ะฝะฐ AniList
- [ ] ะะตัะตะทะฐะฟัััะธะป ะฟัะธะปะพะถะตะฝะธะต (`flutter run -d windows`)
- [ ] ะะฐะถะฐะป ะบะฝะพะฟะบั ะปะพะณะธะฝะฐ
- [ ] ะฃะฒะธะดะตะป debug ะปะพะณะธ ะฒ ะบะพะฝัะพะปะธ (๐๐๐)
- [ ] ะะดะพะฑัะธะป ะฐะฒัะพัะธะทะฐัะธั ะฒ ะฑัะฐัะทะตัะต
- [ ] ะฃะฒะธะดะตะป `โ Auth result` ะฒ ะบะพะฝัะพะปะธ
- [ ] ะัะธะปะพะถะตะฝะธะต ะฒะตัะฝัะปะพัั ะบ ะณะปะฐะฒะฝะพะผั ัะบัะฐะฝั
- [ ] ะัะพัะธะปั ะทะฐะณััะทะธะปัั

---

## ๐ ะะพัะพะฒะพ!

ะะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั ะฒัะตั ัะฐะณะพะฒ ะฐะฒัะพัะธะทะฐัะธั ะดะพะปะถะฝะฐ ัะฐะฑะพัะฐัั ะบะพััะตะบัะฝะพ ะฝะฐ Windows.

**ะะปั Android:** ะะพะด ัะถะต ะฟะพะดะดะตัะถะธะฒะฐะตั ะพะฑะฐ ะฒะฐัะธะฐะฝัะฐ, ะฟัะพััะพ ัะฑะตะดะธัะตัั, ััะพ ะฝะฐ AniList ะดะพะฑะฐะฒะปะตะฝ ัะฐะบะถะต `miyolist://auth`.

---

**ะะตััะธั:** 1.1.0  
**ะะฐัะฐ:** October 10, 2025  
**ะะปะฐััะพัะผะฐ:** Windows (ัะฐะบะถะต ะฟะพะดะดะตัะถะธะฒะฐะตััั Linux, macOS, Android, iOS)

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะผะฐัะตัะธะฐะปั:

- `docs/AUTH_FIX_WINDOWS.md` - ะะพะดัะพะฑะฝะพะต ะพะฟะธัะฐะฝะธะต ะฟัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั
- `docs/QUICK_FIX_AUTH.md` - ะัะฐัะบะฐั ะธะฝััััะบัะธั
- `OAUTH_SETUP.md` - ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ ะฟะพ OAuth2 ะฝะฐัััะพะนะบะต

---

**ะัะถะฝะฐ ะฟะพะผะพัั?** ะัะพะฒะตัััะต ะบะพะฝัะพะปั ะฝะฐ ะฝะฐะปะธัะธะต emoji-ะปะพะณะพะฒ (๐๐๐โ) ะดะปั ะดะธะฐะณะฝะพััะธะบะธ ะฟัะพะฑะปะตะผั.
